{% extends 'base.html' %}
{% block title %}Customer Ledger — {{ customer.name }}{% endblock %}
{% block extra_head %}
<style>
  @media print {.no-print{display:none!important}.card{border:0} .table{font-size:12px}}
  .badge-balance { padding:.35rem .6rem; }
  .badge-balance.green { background:#e9f7ef; color:#1e7e34; }
  .badge-balance.red { background:#fdecea; color:#b21f2d; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-3">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <div>
        <h4 class="mb-0"><i class="fa fa-user"></i> Customer Ledger — {{ customer.name }}</h4>
        <small class="text-muted">{{ customer.phone }} {% if customer.address %} - {{ customer.address }}{% endif %}</small>
    </div>
    <a href="{% url 'ledger_home' %}" class="btn btn-outline-secondary no-print"><i class="fa fa-arrow-left"></i> Back</a>
  </div>

  {% include 'ledger/_filters.html' %}

  <div class="card">
    <div class="card-body p-2 p-lg-3">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div class="small text-muted">Opening Balance</div>
        <div class="fw-bold">₨ {{ opening }}</div>
      </div>

      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th style="width:160px">Date/Time</th>
              <th>Description</th>
              <th class="text-end" style="width:140px">Debit (Sale)</th>
              <th class="text-end" style="width:140px">Credit (Recv)</th>
              <th class="text-end" style="width:160px">Balance</th>
            </tr>
          </thead>
          <tbody>
            {% for e in entries %}
              <tr>
                <td>{{ e.dt|date:"Y-m-d H:i" }}</td>
                <td>{{ e.desc }}</td>
                <td class="text-end text-danger">{% if e.dr > 0 %}₨ {{ e.dr }}{% endif %}</td>
                <td class="text-end text-success">{% if e.cr > 0 %}₨ {{ e.cr }}{% endif %}</td>
                <td class="text-end">
                  <span class="badge badge-balance {% if e.bal > 0 %}red{% else %}green{% endif %}">
                    ₨ {{ e.bal }}
                  </span>
                </td>
              </tr>
            {% empty %}
              <tr><td colspan="5" class="text-center text-muted">No transactions found in this period.</td></tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr class="table-light">
              <th colspan="4" class="text-end">Closing Balance</th>
              <th class="text-end">
                <span class="badge badge-balance {% if closing > 0 %}red{% else %}green{% endif %}">
                  ₨ {{ closing }}
                </span>
              </th>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="text-muted small mt-2">
        <strong>Legend:</strong> <span class="text-danger">Red (Positive)</span> = Customer owes us. <span class="text-success">Green (Negative)</span> = Advance payment.
      </div>
    </div>
  </div>
</div>
{% endblock %}